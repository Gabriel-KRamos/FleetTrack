{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Motoristas</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div class="dashboard-container">
        <header class="page-header">
            <div class="header-info">
                <h1>Gerenciamento de Motoristas</h1>
                <p>Monitore e gerencie os motoristas da sua frota</p>
            </div>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚Üê Voltar ao Dashboard</a>
        </header>

        {% if messages %}
        <div class="messages" style="margin-bottom: 1.5rem;">
            {% for message in messages %}
            <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'success' %}alert-success{% else %}alert-{{ message.tags }}{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        
        <section class="driver-stat-cards">
            <div class="driver-stat-card color-blue">
                <div class="driver-stat-icon">üë§</div>
                <div class="driver-stat-info">
                    <span class="value">{{ stats.total }}</span>
                    <span class="title">Total de Motoristas</span>
                </div>
            </div>
            <div class="driver-stat-card color-green">
                <div class="driver-stat-icon">‚úÖ</div>
                <div class="driver-stat-info">
                    <span class="value">{{ stats.active }}</span>
                    <span class="title">Ativos</span>
                </div>
            </div>
            <div class="driver-stat-card color-red">
                <div class="driver-stat-icon">‚ùå</div>
                <div class="driver-stat-info">
                    <span class="value">{{ stats.inactive }}</span> 
                    <span class="title">Inativos / Suspensos</span>
                </div>
            </div>
        </section>

        <main class="dashboard-content">
            <section class="card">
                <div class="table-header">
                    <h2>Motoristas</h2>
                    <button class="btn btn-primary" id="open-add-driver-modal">+ Adicionar Motorista</button>
                </div>

                <form method="get" class="filter-bar">
                    <div class="search-container">
                        <input type="text" name="search" class="search-input" placeholder="Buscar por nome, email, CNH..." value="{{ search_query }}">
                    </div>
                    <select name="status" class="status-filter" onchange="this.form.submit()">
                        <option value="">Todos os Status</option>
                        <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Ativo</option>
                        <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inativo / Suspenso</option>
                    </select>
                </form>

                <div class="table-wrapper">
                    <table class="vehicle-table driver-table">
                        <thead>
                            <tr>
                                <th>Motorista</th>
                                <th>Email</th>
                                <th>CNH</th>
                                <th>Status</th>
                                <th>Data de Admiss√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for driver in drivers %}
                            <tr data-pk="{{ driver.pk }}" 
                                data-full_name="{{ driver.full_name }}" 
                                data-email="{{ driver.email }}"
                                data-phone_number="{{ driver.phone_number|default:'' }}"
                                data-license_number="{{ driver.license_number|default:'' }}"
                                data-admission_date="{{ driver.admission_date|date:'Y-m-d' }}"
                                data-demission_date="{{ driver.demission_date|date:'Y-m-d'|default:'' }}"
                                data-is_active="{{ driver.is_active }}"
                                >
                                <td>
                                    <div class="driver-cell">
                                        <div class="driver-avatar-circle" style="background-color: #e0e7ff; color: #4338ca;">
                                            {{ driver.full_name|slice:":1" }}{{ driver.full_name|slice:"-1:"|upper }}
                                        </div>
                                        <div class="driver-info">
                                            <strong>{{ driver.full_name }}</strong>
                                            <small>ID: D{{ driver.pk|stringformat:"04d" }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ driver.email }}</td>
                                <td>
                                    <span class="license-tag">{{ driver.license_number }}</span>
                                </td>
                                <td>
                                    {% if driver.is_active %}
                                        <span class="status-tag-driver status-active">‚úì Ativo</span>
                                    {% else %}
                                        <span class="status-tag-driver status-suspended">‚úó Suspenso</span>
                                    {% endif %}
                                </td>
                                <td>{{ driver.admission_date|date:"d/m/Y" }}</td>
                                <td class="actions">
                                    <a href="#" class="action-view action-link" title="Ver Detalhes">üëÅÔ∏è Ver</a>
                                    {% if driver.is_active %}
                                    <a href="#" class="action-edit action-link" title="Editar">‚úèÔ∏è Editar</a>
                                    <a href="#" class="action-delete action-link" title="Demitir">üóëÔ∏è Demitir</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="6" style="text-align: center; padding: 2rem;">Nenhum motorista encontrado.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-overlay" id="add-driver-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="driver-modal-title">Adicionar Motorista</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form method="post" id="driver-form" class="modal-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="{{ add_form.full_name.id_for_label }}">Nome Completo</label>
                    {{ add_form.full_name }}
                </div>
                <div class="form-group">
                    <label for="{{ add_form.email.id_for_label }}">Email</label>
                    {{ add_form.email }}
                </div>
                <div class="form-group">
                    <label for="{{ add_form.license_number.id_for_label }}">N√∫mero da CNH</label>
                    {{ add_form.license_number }}
                </div>
                <div class="form-group">
                    <label for="{{ add_form.admission_date.id_for_label }}">Data de Admiss√£o</label>
                    {{ add_form.admission_date }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="driver-submit-button">Salvar</button>
                </div>
            </form>
            </div>
    </div>
    
    <div class="modal-overlay" id="demission-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2>Demitir Motorista</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form method="post" id="demission-form">
                {% csrf_token %}
                <p>Voc√™ tem certeza que deseja demitir este motorista? Esta a√ß√£o √© irrevers√≠vel.</p>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">Sim, Confirmar Demiss√£o</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="driver-details-modal">
        <div class="modal-content details-modal" style="max-width: 600px;">
            <div class="modal-header">
                <div class="details-header-info">
                    <span class="details-icon" style="font-size: 1.5rem;">üë§</span>
                    <div>
                        <h2 id="details-driver-name"></h2>
                        <p id="details-driver-id"></p>
                    </div>
                </div>
                <button class="close-modal">&times;</button>
            </div>

            <div class="modal-tab-nav">
                <a href="#" class="modal-tab-link active" data-target="tab-panel-details">Detalhes</a>
                <a href="#" class="modal-tab-link" data-target="tab-panel-routes">Hist. Rotas</a>
            </div>

            <div class="modal-tab-panel" id="tab-panel-details">
                <div class="details-section">
                    <h4>Status Atual</h4>
                    <p><span id="details-status-tag" class="status-tag-driver"></span></p>
                </div>
                <div class="details-section">
                    <h4>Informa√ß√µes do Motorista</h4>
                    <div class="info-grid">
                        <div class="info-item"><small>Nome Completo</small><strong id="details-full-name"></strong></div>
                        <div class="info-item"><small>Email</small><strong id="details-email"></strong></div>
                        <div class="info-item"><small>N¬∫ da CNH</small><strong id="details-license-number"></strong></div>
                        <div class="info-item"><small>Data de Admiss√£o</small><strong id="details-admission-date"></strong></div>
                        <div class="info-item" id="details-demission-item" style="display: none;">
                            <small>Data de Demiss√£o</small>
                            <strong id="details-demission-date"></strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-tab-panel" id="tab-panel-routes" style="display: none;">
                <p class="history-loading">Carregando hist√≥rico...</p>
            </div>

            <div class="modal-footer" style="margin-top: 1.5rem;">
                <button type="button" class="btn btn-secondary close-modal">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <script src="{% static 'js/drivers.js' %}"></script>
</body>
</html>