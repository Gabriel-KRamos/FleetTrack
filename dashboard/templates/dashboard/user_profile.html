{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usu√°rio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body {% if show_password_form_errors %}data-show-password-errors="true"{% endif %}>
    <div class="dashboard-container">

        <header class="page-header">
            <div class="header-info">
                <h1>Perfil do Usu√°rio</h1>
                <p>Gerencie as configura√ß√µes e prefer√™ncias da sua conta</p>
            </div>
            <div>
                <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚Üê Voltar ao Dashboard</a>
            </div>
        </header>

         {% if messages %}
        <div class="messages" style="margin-bottom: 1.5rem;">
            {% for message in messages %}
            <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'success' %}alert-success{% else %}alert-{{ message.tags }}{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        <main class="profile-layout">
            <div class="card profile-header-card">
                <div class="profile-avatar">üë§</div>
                <div class="profile-header-info">
                    <h2>{{ user.first_name|default:'Administrador' }}</h2>
                    <p>@{{ user.username }}</p>
                    <p>{{ profile.company_name|default:'FleetTrack Inc.' }}</p>
                </div>
                <div class="profile-header-actions">
                    <a href="#" id="edit-profile-btn" class="btn btn-primary">Editar Perfil</a>
                </div>
            </div>

            <form method="post" id="profile-form" action="{% url 'user-profile' %}">
                {% csrf_token %}
                <div class="card profile-info-card">
                    <div class="profile-info-grid">
                        <div class="profile-info-item">
                            <small>Nome Completo</small>
                            <strong class="profile-display">{{ user.first_name|default:'N/A' }}</strong>
                            <input type="text" class="profile-input" name="{{ user_form.first_name.name }}" id="{{ user_form.first_name.id_for_label }}" value="{{ user_form.first_name.value|default:'' }}">
                            {{ user_form.first_name.errors }}
                        </div>
                        <div class="profile-info-item">
                            <small>Nome da Empresa</small>
                            <strong class="profile-display">{{ profile.company_name|default:'N/A' }}</strong>
                            <input type="text" class="profile-input" name="{{ company_form.company_name.name }}" id="{{ company_form.company_name.id_for_label }}" value="{{ company_form.company_name.value|default:'' }}">
                            {{ company_form.company_name.errors }}
                        </div>
                        <div class="profile-info-item">
                            <small>Endere√ßo de Email (Login)</small>
                             <strong class="profile-display">{{ user.email|default:'N/A' }}</strong>
                             <input type="email" class="profile-input" name="{{ user_form.username.name }}" id="{{ user_form.username.id_for_label }}" value="{{ user_form.username.value|default:'' }}" required>
                             {{ user_form.username.errors }}
                        </div>
                    </div>
                    <div class="profile-edit-actions">
                         <button type="button" id="cancel-edit-btn" class="btn btn-secondary">Cancelar</button>
                         <button type="submit" name="update_profile" id="save-changes-btn" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    </div>
                </div>
            </form>

            <div class="card security-settings-card">
                <div class="card-header" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <h4>Configura√ß√µes de Seguran√ßa</h4>
                    <a href="#" id="change-password-btn" class="btn btn-secondary">Alterar Senha</a>
                </div>

                <form method="post" id="password-form" action="{% url 'user-profile' %}" style="display: none;">
                    {% csrf_token %}
                    <div id="password-change-section">
                         <div class="profile-info-grid">
                            <div class="form-group">
                                <label for="{{ password_form.old_password.id_for_label }}">Senha Atual</label>
                                {{ password_form.old_password }}
                                {{ password_form.old_password.errors }}
                            </div>
                        </div>
                        <div class="password-grid">
                            <div class="form-group">
                                <label for="{{ password_form.new_password1.id_for_label }}">Nova Senha</label>
                                {{ password_form.new_password1 }}
                                {{ password_form.new_password1.errors }}
                            </div>
                            <div class="form-group">
                                <label for="{{ password_form.new_password2.id_for_label }}">Confirme Nova Senha</label>
                                {{ password_form.new_password2 }}
                                {{ password_form.new_password2.errors }}
                            </div>
                        </div>
                        {{ password_form.non_field_errors }}

                        <div class="password-change-actions">
                            <button type="button" id="cancel-password-change-btn" class="btn btn-secondary">Cancelar</button>
                            <button type="submit" name="update_password" id="update-password-btn" class="btn btn-primary">Atualizar Senha</button>
                        </div>
                    </div>
                </form>
                </div>
            </div>
        </main>
    </div>

    <script src="{% static 'js/profile.js' %}"></script>
</body>
</html>